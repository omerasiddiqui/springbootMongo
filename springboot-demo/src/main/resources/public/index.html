<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Spring Boot & MongoDB</title>
</head>
<body>

    <div id="container">
    
    <div class="header-text">
        <h1>Employee List</h1>
        <h3 style="font-size: 1.035rem;">JSON <a id="link" href="http://localhost:8080/employees/all">link</a> to employee list.</h3>
    </div>
    
    <div id="tabs">
        <button id="fetchBtn">Get Employees</button>
        <button id="addUserBtn">Add Employee</button>
        <button id="deleteUserBtn">Delete Employee</button>
    </div>
    
    <div id="content">
        <ul id="employees">
    <!-- 		content goes here -->
        </ul>
    </div>
    
    <div id="addNewEmployee" style="display: none;">
        <h4>Add New Employee</h4>
        <div></div>
        <form name="addNewEmp" method="POST" action="/employees" id="addNewEmpForm">
            <div>Full Name: <input type="text" name="name" id="name" /> </div>
            <div>Job Title:  <input type="text" name="jobTitle" id="jobTitle" /> </div>
	        <div>Region:  <input type="text" name="region" id="region" /> </div>
            <div>Email: <input type="text" name="email" id="email" /> </div>
            
            <input id="addSubmit" value="Submit" type="button" />
        </form>
    
    </div>
    
    <div id="deleteEmployee" style="display: none;">
        <h4>Delete Employee</h4>
        <form name="deleteEmp" method="POST" action="/employees" id="deleteEmpForm">
            <div>ID: <input type="text" name="id" id="id" /> </div>
            
            <input id="deleteSubmit" value="Submit" type="button" />
        </form>
    
    </div>
    
    </div>
    
    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <style>
    @import url('https://fonts.googleapis.com/css?family=K2D');
    h4 {
        margin: 5px 0;
    }
    ul {
        padding: 0;
    }
    body {
        background: linear-gradient(to right, #134e5e, #71b280);
        font-family: 'K2D', sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    #container {
        background: offwhite;
        color: white;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 30px;
        width: 90%;
        height: 70vh;
        border-radius: 10px;
        position: relative;
    }
    #content {
        margin: -100px;	
        width: 58%;
    }
    #link {
        color: #6EAF7F;
        text-decoration: underline;
    }
    #fetchBtn, #addUserBtn, #deleteUserBtn, #addSubmit, #deleteSubmit {
        padding: 9px 12px;
        background: linear-gradient(to right, #134e5e, #71b280);
        color: white;
        border-radius: 25px;
        font-size: 1rem;
        outline: none;
        transition: 0.3s linear;
        margin: 2px 0;
        font-size: 0.8rem;
        
    }
    #fetchBtn:hover, #addUserBtn:hover, #deleteUserBtn:hover, #submit:hover {
        background: #6EAF7F;
    }
    #addSubmit, #deleteSubmit {
        align-self: center; 
        margin: 10px 0;
        padding: 6px 9px;
        margin-bottom: 0;
    }
    #addNewEmployee, #deleteEmployee {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        width: 50%; 
        border: 1px solid #6EAF7F;
    }
    #deleteEmployee {
        width: 35%;
    }
    #addNewEmpForm, #deleteEmpForm {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-end;
        margin: 0 auto; 
    }
    #tabs {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-self: flex-start;
        margin-left: 5px;
    }
    .header-text {
        position: absolute;
        top: 0;
        left: 34.5%;
    }
    #tabs {
        position: absolute;
        top: 160;
        left: 0;
    }
    .employee-list-item {
        font-size: 0.9rem; 
        border-bottom: 1px solid #16515F; 
        border-top: 1px solid #16515F; 
        list-style: none; 
        text-align: center;
    }
    #addNewEmployee, #deleteEmployee {
        margin: 0 auto; 
        text-align: center; 
        padding: 10px 0;
    }
        
    </style>
    <script>
      
      $(document).ready(function() {
        
        $("#fetchBtn").on("click", function() {
            $("#addNewEmployee").hide();
            $("#deleteEmployee").hide();
            var fetchAll = $.getJSON( "http://localhost:8080/employees/all", function( data ) {
                  console.log("GET'ing employees: ");
                  console.log(data);
             	  $("#employees").empty();

                  
                  data.forEach(function(emp) {
                      $("#employees").append(`<li class="employee-list-item" id="emp-${emp.id}"><a style="color: white;" href="/employees/${emp.id}">${emp.name} - ${emp.jobTitle}</a></li>`)
                  });
                  
                    $("#content").show().css("border", "1px solid white");
            
            });
        });
        
        
        
        
        $("#addUserBtn").on("click", function() {
            $("#deleteEmployee").hide();
            $("#content").hide();
            $("#addNewEmployee").toggle();
        
        })
        
            $("#deleteUserBtn").on("click", function() {
            
            $("#content").hide();
            $("#addNewEmployee").hide();
            $("#deleteEmployee").toggle();
        
        })
        
        ////////////
        
        // POST
        
        $("#addSubmit").on("click", function(e) {
        	
        	var newEmployee = {
        			name: $("#name").val(),
        			jobTitle: $("#jobTitle").val(),
        			region: $("#region").val(),
        			email:$ ("#email").val() 
        	}
        	
        	e.preventDefault();
        	$.ajax({
        		url: "/employees",
        		type: "POST",
        		data: JSON.stringify(newEmployee),
        		contentType: "application/json",
        		success: function(data) {
        			console.log("POST'ed: " + JSON.stringify(newEmployee))
        		},
        		error: function(xhr, text, err) {
        		  	console.log('error: ',err);
       	         	console.log('text: ', text);
       	          	console.log('xhr: ',xhr);
        		}	
        	})
        	
        	$("#name").val(""),
        	$("#jobTitle").val(""),
        	$("#region").val(""),
        	$("#email").val("")
        	
        })
        
        // DELETE
        
  $("#deleteSubmit").on("click", function(e) {
	  e.preventDefault();
	  	var id = $("#id").val()
       	var deletedEmployee = {
   			id: id
       	};
       	
       	
       	
       	$.ajax({
       		url: `/employees/${id}`,
       		type: "DELETE",
       		data: JSON.stringify(deletedEmployee),
       		contentType: "application/json",
       		success: function(data) {
    			console.log("DELETE'ed: " + JSON.stringify(deletedEmployee))
       		},
       		error: function(xhr, text, err) {
       		  	console.log('error: ',err);
      	         	console.log('text: ', text);
      	          	console.log('xhr: ',xhr);
       		}	
       	})
       	
       	$("#id").val("");
       	
       })
       
   });
      
    </script>
    </body>
</html>